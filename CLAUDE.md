# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

**ClaudeTetris** - テトリス初心者をターゲットにした、革新的なポイントシステムとフィーバーモードを持つWebベースのテトリスゲーム。モダンブラウザ向けにHTML5、CSS3、JavaScript（ES6+）で構築。

## プロジェクトアーキテクチャ

### コアゲームメカニクス
- **ポイントシステム**: テトリミノ設置1回につき10ポイント獲得、戦略的優位性に使用可能
- **ブロック交換**: 30ポイント消費で現在落下中のブロックを交換（Eキー）
- **フィーバーモード**: 25回テトリミノ設置毎に発動、25秒間の特別効果:
  - 無料無制限ブロック交換
  - 全スコア3倍ボーナス
- **ホールドシステム**: 標準テトリスのホールド機能（Cキー）

### ゲーム構造
- **ゲームフィールド**: クラシックテトリスルールに従う10x20グリッド
- **テトリミノタイプ**: 標準7種類（I, O, T, S, Z, J, L）
- **UIレイアウト**: 3エリア構成:
  - 左: HOLD表示、フィーバーゲージ
  - 中央: ゲームフィールド
  - 右: SCORE、POINTS、NEXTブロック

### 操作方法
- 矢印キー: 移動（左/右/ソフトドロップ）と回転（上）
- スペース: ハードドロップ
- C: ホールド機能
- E: NEXTブロック交換（独自機能）

## 開発コマンド

バニラWebプロジェクトのため、ビルドシステムは不要:

```bash
# 開発
# index.htmlをブラウザで直接開くか、ローカルサーバーを使用:
python -m http.server 8000
# または
npx serve .

# テスト
# ブラウザでの手動テスト（Chrome, Firefox, Safari, Edge）
```

## ファイル構造（作成予定）

```
/
├── index.html          # 3エリアレイアウトのメインゲームページ
├── style.css          # ゲームスタイリングと視覚効果
├── script.js          # メインゲームロジックと状態管理
├── js/
│   ├── tetrominos.js  # テトリミノ定義とロジック
│   ├── gameField.js   # ゲームフィールド管理
│   ├── pointSystem.js # ポイント獲得と交換システム
│   ├── feverMode.js   # フィーバーモードメカニクス
│   ├── scoreManager.js # スコア管理と段位システム
│   └── ui.js          # UI更新と表示ロジック
└── readme.txt         # プロジェクト仕様書（日本語）
```

## ゲーム状態とロジック

### 主要ゲーム状態
- **スタート画面**: タイトルとSTART GAMEボタン
- **プレイ中**: 全メカニクスが有効なメインゲーム
- **フィーバーモード**: 25秒間の特別強化ゲームプレイ
- **ゲームオーバー**: 最終スコア表示とPLAY AGAINオプション

### スコア計算
- 1ライン: 100点
- 2ライン: 300点
- 3ライン: 500点
- 4ライン（テトリス）: 800点
- フィーバーモード中は全スコア3倍
- レベルに応じたスコア倍率適用

## 実装注意事項

- 仕様書要件に従う: ハードコード禁止
- 同名の関数/変数名を避ける
- 初心者向けゲームプレイに焦点、明確な視覚フィードバック
- モチベーション維持のためフィーバーモード進捗カウンター実装
- フィーバーモード中のボーナススコア表示
- モダンブラウザでの滑らかな60fps保証

## 視覚効果優先順位

1. フィーバーモード発動アニメーション（「FEVER!」表示）
2. ボーナススコア表示（「+2400 (x3 BONUS!)」）
3. フィーバータイマー/ゲージ表示
4. ブロック交換コスト表示（「-30P」→「-45P」→「-65P」と累積表示）
5. フィーバーモード中の背景エフェクト

## デザイン要件 - 高級感の追求

### カラーパレット
- **ベースカラー**: 深いグレー（#1a1a1a, #2d2d2d）とチャコール系
- **アクセントカラー**: エレガントなネオン（#00ff88, #ff6b6b, #4ecdc4）
- **プレミアム効果**: 金色グラデーション（#ffd700〜#ff8c00）をフィーバーモードに使用
- **テキスト**: 高コントラストの白（#ffffff）とソフトグレー（#cccccc）

### タイポグラフィ
- **メインフォント**: モダンサンセリフ（'Segoe UI', 'Arial', sans-serif）
- **数値表示**: モノスペースフォント（'Consolas', 'Monaco', monospace）
- **タイトル**: 太字でレタースペーシング調整（letter-spacing: 2px）
- **階層**: 明確なフォントサイズ差とウェイト差

### 視覚エフェクト
- **シャドウ**: 深い影効果（box-shadow: 0 8px 32px rgba(0,0,0,0.3)）
- **グラデーション**: 微細な線形グラデーション背景
- **ボーダー**: 1px細線とroundedコーナー（border-radius: 8px）
- **ホバー効果**: 滑らかなtransition（0.3s ease）
- **グロー**: フィーバーモード時の発光効果（box-shadow glow）

### レイアウト高級化
- **スペーシング**: 十分な余白（padding: 20px〜40px）
- **アライメント**: 完璧な中央揃えと均等配置
- **コンテナ**: 角丸とサブトルシャドウ付きカード設計
- **レスポンシブ**: 全画面サイズで美しい比率維持

### プレミアム要素
- **アニメーション**: 60fps滑らか（CSS transforms使用）
- **パーティクル**: フィーバーモード時の微細なキラキラ効果
- **プログレスバー**: グラデーション付き進捗表示
- **ボタン**: 立体感のある押下フィードバック
- **ローディング**: エレガントなスピナー/進捗アニメーション

---

# Tetrisアプリ開発仕様書 🎮 (最終版)

このドキュメントは、Claude Codeを使用してWebブラウザで動作するTetrisアプリを開発するための詳細仕様書です。

## 1. プロジェクト概要

- **プロジェクト名**: ClaudeTetris
- **コンセプト**: 「間口は広く、奥行きは深く」。初心者向けの革新的なアシスト機能と、上級者がやり込める奥深いゲームシステムを両立させる。
- **ターゲットプラットフォーム**: モダンなWebブラウザ (Chrome, Firefox, Safari, Edge)
- **使用技術スタック**:
  - HTML5
  - CSS3
  - JavaScript (ES6+)

## 2. 画面設計とUIレイアウト

ゲーム画面は主に3つのエリアで構成されます。

| 左エリア (情報) | 中央エリア (ゲーム) | 右エリア (情報) |
|---|---|---|
| HOLD ブロック表示 | ゲームフィールド (10x20グリッド) | SCORE 表示 |
| FEVER GAUGE (カウンター) |  | POINTS (所持ポイント) 表示 |
| LEVEL 表示 |  | NEXT ブロック表示 |

## 3. ゲームの基本仕様

### 3.1 ゲームフィールド
- **サイズ**: 10 (幅) x 20 (高さ) のグリッド

### 3.2 操作方法
- **← →**: 移動
- **↑**: 回転
- **↓**: ソフトドロップ
- **スペース**: ハードドロップ
- **C**: ホールド
- **E**: NEXTブロック交換

### 3.3 レベルシステム
- **レベルアップ**: 30秒経過するごとにレベルが1上昇し、ブロックの自然落下速度が速くなる
- **自然落下速度**: レベル1: 1秒/行、レベル5: 0.6秒/行、レベル10: 0.4秒/行、レベル15: 0.3秒/行、レベル20: 0.25秒/行、レベル25: 0.22秒/行、レベル30: 0.2秒/行
- **スコア倍率**: レベルに応じてスコア倍率が上昇（レベル5: 1.2倍、レベル10: 1.5倍、レベル15: 2.0倍、レベル20: 2.5倍、レベル25: 3.0倍、レベル30: 3.5倍）

### 3.4 基本スコア計算
- **1ライン**: 100点
- **2ライン**: 300点
- **3ライン**: 500点
- **4ライン (Tetris)**: 800点

## 4. ゲームのコアメカニクス：ポイント＆エクスチェンジ

### 4.1 ポイントシステム

**ポイント獲得条件**:
- **ブロック設置**: 1ブロック固定につき +10ポイント
- **ソフトドロップボーナス**: ソフトドロップキーで実際に移動した行数 × 0.5ポイント（小数点切り捨て）
- **ハードドロップボーナス**: ハードドロップで実際に移動した行数 × 1ポイント
- **テクニカルボーナス**: T-Spin成功時などに追加ポイント

**重要な修正点**:
- ソフト/ハードドロップのポイントは「実際に落下させた距離」ではなく「キー操作で移動した距離」に基づく
- ソフトドロップは1行につき0.5ポイント、ハードドロップは1行につき1ポイントに調整

### 4.2 NEXTブロック交換 (エクスチェンジ)
- **基本コスト**: 30ポイントを消費し、NEXTブロックを別のランダムなブロックに交換する
- **累積コストシステム**: 連続でブロック交換を行うと、交換コストが累積的に上昇する
  - 1回目: 30ポイント
  - 2回目: 45ポイント（+15）
  - 3回目: 65ポイント（+20）
  - 4回目: 90ポイント（+25）
  - 5回目以降: 120ポイント（+30ずつ増加）
- **コストリセット**: ブロックを1つ設置すると累積コストがリセットされ、基本コスト（30ポイント）に戻る
- **戦略性**: 不利なブロックを有利なブロックに変更可能だが、連続使用には制限がある

### 4.3 フィーバーモード
- **突入条件**: ブロックを累計で20個設置するごとに自動で発動
- **持続時間**: 30秒間
- **効果**:
  - エクスチェンジが無料＆無限になる
  - 全ての獲得スコアが4倍になる
  - BGMと背景が変化し、爽快感を演出する

## 5. 上級者向けやり込み要素

### 5.1 テクニカルボーナス
初心者向けの楽しさを阻害せず、熟練プレイヤーの挑戦意欲を刺激するためのスコア＆ポイントボーナス。

- **T-Spin**: Tブロックを特定の形でねじ込んでラインを消すと、大量のボーナススコアと追加ポイントを獲得
  - T-Spin Single: 2,000点ボーナス
  - T-Spin Double: 6,000点ボーナス
  - T-Spin Triple: 12,000点ボーナス
- **Back-to-Back**: テトリスやT-Spinを連続で成功させると、スコアにx2.0のボーナス倍率が付与される
- **パーフェクトクリア**: フィールド上のブロックを全て消すと、25,000点の特大ボーナス
- **コンボシステム**: 連続でラインを消すと、コンボごとに30%のスコア倍率が加算される

### 5.2 追加ボーナスシステム
- **高速プレイボーナス**: 一定時間内にラインを消すと10%のボーナス
- **効率プレイボーナス**: 最小のブロック交換でハイスコアを目指すと20%のボーナス
- **生存時間ボーナス**: 長時間プレイで5%のボーナス

### 5.3 スキルアップ要素
- **コンボシステム**: 連続でラインを消すとボーナス倍率が増加
- **効率プレイ**: 最小の交換回数でハイスコアを目指す
- **タイムアタック**: 一定スコアに到達するまでの時間を競う

## 6. 実装における重要な設計思想

### 6.1 初心者への配慮
- **視覚的フィードバック**: 操作結果が即座に分かる明確なUI
- **ポイントシステム**: 失敗を補える救済メカニクス
- **段階的な難易度**: レベルアップによる自然な成長曲線

### 6.2 上級者への挑戦
- **テクニカル要素**: 深いスキル要求と高いスコアポテンシャル
- **戦略性**: ポイント管理とブロック交換の最適化
- **やり込み要素**: 多様なボーナスと達成目標

### 6.3 バランス設計
- **ポイント経済**: 獲得と消費のバランス調整
- **フィーバー頻度**: 適切な間隔での爽快感提供
- **難易度曲線**: 挫折せずに上達できる進行設計

## 7. スコア記録・ランキング・段位システム

### 7.1 スコア記録システム
- **ローカルストレージ**: ブラウザのlocalStorageを使用してスコア履歴を保存
- **記録データ**: 最終スコア、プレイ日時、到達レベル、クリアライン数、テトリス数、T-Spin数
- **最大記録数**: 最新20件のスコアを保持（古いデータは自動削除）

### 7.2 ランキング機能
- **ハイスコアランキング**: トップ10のスコアを表示
- **詳細情報表示**: 各記録の日時、レベル、統計情報を表示
- **ランキング画面**: ゲームオーバー画面からアクセス可能
- **記録更新通知**: 新記録達成時の特別演出

### 7.3 段位システム（初心者フレンドリー版）
段位はスコアに基づいて自動的に決定される。初心者のモチベーション維持を重視した現実的な閾値に調整：

**段位一覧**:
- **無段**: 0点〜
- **初段**: 200点〜（2ライン消去で達成可能）
- **二段**: 800点〜（8ライン消去で達成可能）
- **三段**: 2,000点〜（20ライン消去で達成可能）
- **四段**: 4,000点〜（40ライン消去で達成可能）
- **五段**: 8,000点〜（80ライン消去で達成可能）
- **六段**: 15,000点〜（150ライン消去で達成可能）
- **七段**: 25,000点〜（250ライン消去で達成可能）
- **八段**: 40,000点〜（400ライン消去で達成可能）
- **九段**: 60,000点〜（600ライン消去で達成可能）
- **十段**: 90,000点〜（900ライン消去で達成可能）
- **名人**: 130,000点〜（1,300ライン消去で達成可能）
- **竜王**: 200,000点〜（2,000ライン消去で達成可能）
- **永世名人**: 300,000点〜（3,000ライン消去で達成可能）

**段位達成の現実性（初心者フレンドリー）**:
- **初段〜三段**: 初心者（2〜20分のプレイで達成可能）
- **四段〜六段**: 中級者（20〜60分のプレイで達成可能）
- **七段〜九段**: 上級者（1〜2時間のプレイで達成可能）
- **十段〜名人**: プロレベル（2〜3時間のプレイで達成可能）
- **竜王〜永世名人**: 世界トップレベル（3時間以上のプレイで達成可能）

**初心者向け特別機能**:
- **段位達成ボーナス**: 初段〜三段達成時に特別な視覚効果とサウンド
- **段位表示**: ゲーム画面左エリアのLEVEL表示を拡張
- **記録詳細**: ゲームオーバー画面に詳細統計を表示

### 7.4 UI追加要素
- **ランキングボタン**: スタート画面とゲームオーバー画面に追加
- **段位表示**: ゲーム画面左エリアのLEVEL表示を拡張
- **記録詳細**: ゲームオーバー画面に詳細統計を表示

## 8. 初心者向けモチベーション維持機能

### 9.1 段位達成ボーナスシステム
初心者の早期段位達成を祝い、モチベーションを維持するための特別機能：

**段位達成ボーナス**:
- **初段達成**: 特別な視覚効果 + 20ポイントボーナス
- **二段達成**: 派手なアニメーション + 30ポイントボーナス
- **三段達成**: 豪華な演出 + 50ポイントボーナス
- **四段以上**: 段位に応じたポイントボーナス（段位 × 10ポイント）

### 9.2 初心者向けチュートリアル機能
- **初回プレイ時**: 基本的な操作方法のガイド表示
- **段位別ヒント**: 各段位で適切な戦略ヒントを表示
- **実績システム**: 小さな目標達成でモチベーション維持

### 9.3 視覚的フィードバック強化
- **ライン消去エフェクト**: 初心者でも分かりやすい派手な演出
- **ポイント獲得表示**: リアルタイムでポイント獲得を視覚化
- **フィーバーモード進捗**: より分かりやすいゲージ表示

### 9.4 初心者向けバランス調整
- **フィーバーモード頻度**: 初心者でも頻繁に体験できるよう調整
- **ポイント獲得**: 基本的な操作でもポイントを獲得
- **失敗の軽減**: エクスチェンジ機能で運の要素を軽減

### 9.5 段位表示の改善
- **現在段位**: ゲーム画面で常に現在の段位を表示
- **次の段位**: 次の段位までの必要スコアを表示
- **段位カラー**: 各段位に固有の色を割り当て

### 9.6 その他の機能案

#### **A. コンボシステムの強化**
- **コンボカウンター**: 連続ライン消去の回数を表示
- **コンボボーナス**: コンボ数に応じたスコア倍率
- **コンボブレイク**: コンボが途切れた時の視覚的フィードバック

#### **B. 実績システム**
- **初回ライン消去**: 初めてラインを消した時の記念
- **連続プレイ**: 毎日プレイした日数の記録
- **スコアマイルストーン**: 1000点、5000点などの節目達成
- **テクニック実績**: T-Spin、Back-to-Back等の特殊技達成

#### **C. デイリーチャレンジ**
- **日替わり目標**: 毎日異なる目標（例：10ライン消去、フィーバーモード3回発動）
- **チャレンジ報酬**: 目標達成で特別なポイントボーナス
- **週間ランキング**: 1週間の総スコアランキング

#### **D. カスタマイズ機能**
- **テトリミノスキン**: 段位に応じてテトリミノの見た目を変更
- **フィールドテーマ**: 段位に応じて背景テーマを変更
- **エフェクト設定**: 視覚効果の強さを調整可能

#### **E. リプレイ機能**
- **ハイスコアリプレイ**: 最高スコアのプレイを再生
- **シェア機能**: スコアや段位をSNSでシェア
- **統計分析**: プレイスタイルの分析と改善提案

#### **F. サウンドシステム**
- **BGM選択**: 複数のBGMから選択可能
- **効果音カスタマイズ**: ライン消去、フィーバーモード等の効果音
- **段位別BGM**: 段位に応じてBGMが変化

#### **G. アクセシビリティ機能**
- **色覚対応**: 色覚特性に配慮したカラーパレット
- **操作カスタマイズ**: キー配置の変更可能
- **UIスケール**: 画面サイズに応じたUI調整

#### **H. ソーシャル機能**
- **フレンドシステム**: 友達とのスコア比較
- **ギルドシステム**: チームでの協力プレイ
- **イベントモード**: 期間限定の特別ルール

#### **I. 学習支援機能**
- **練習モード**: 特定のテクニックを練習
- **ヒントシステム**: 行き詰まった時のアドバイス
- **スキルツリー**: 習得したテクニックの可視化

#### **J. パフォーマンス機能**
- **統計ダッシュボード**: 詳細なプレイ統計
- **進歩グラフ**: スコアの推移をグラフ表示
- **目標設定**: 個人目標の設定と追跡

## 10. 技術的な実装方針

### 10.1 パフォーマンス
- **60fps保証**: 滑らかなアニメーションとレスポンス
- **メモリ効率**: 適切なオブジェクト管理
- **ブラウザ互換性**: 主要ブラウザでの安定動作

### 10.2 コード品質
- **モジュール設計**: 機能別の明確な分離
- **可読性**: 明確な命名規則と適切なコメント
- **拡張性**: 新機能追加に対応可能な構造

### 10.3 ユーザビリティ
- **直感的操作**: 一般的なテトリス操作との一貫性
- **レスポンシブ**: 様々な画面サイズへの対応
- **アクセシビリティ**: 色覚特性への配慮とキーボード操作

## 11. 実装機能詳細仕様

### 11.1 コンボシステムの強化

#### **システム設定**
```javascript
const COMBO_CONFIG = {
    MIN_COMBO: 2,                    // コンボ開始ライン数
    MAX_COMBO_MULTIPLIER: 3.0,       // 最大コンボ倍率
    COMBO_DECAY_TIME: 3000,          // コンボ継続時間（ミリ秒）
    BASE_MULTIPLIER: 0.1             // コンボごとの基本倍率
};
```

#### **実装内容**
1. **コンボカウンター表示**
   - ゲーム画面右上にコンボ数表示
   - コンボ数に応じて色とサイズが変化（1-3: 青、4-6: 黄、7+: 赤）
   - コンボ継続中はパルスアニメーション
   - フォントサイズ: 1.2em、色: #ff6b6b

2. **コンボボーナス計算**
   - コンボ数に応じたスコア倍率: `1 + (コンボ数 - 1) × 0.1`
   - 最大倍率: 3.0倍
   - フィーバーモード中はさらに倍率が加算
   - コンボ継続時間: 3秒

3. **コンボブレイク表示**
   - コンボが途切れた時の「COMBO BREAK!」表示
   - コンボ継続時間の視覚的表示
   - コンボブレイク時の特別なサウンド効果

### 11.2 段位達成ボーナスシステム

#### **ボーナス設定**
```javascript
const DAN_BONUS = {
    SHODAN: { points: 20, effect: 'shodan_effect' },
    NIDAN: { points: 30, effect: 'nidan_effect' },
    SANDAN: { points: 50, effect: 'sandan_effect' },
    YONDAN: { points: 40, effect: 'yondan_effect' },
    GODAN: { points: 50, effect: 'godan_effect' }
    // 以降も段位 × 10ポイント
};
```

#### **視覚効果設定**
```javascript
const ACHIEVEMENT_EFFECTS = {
    shodan_effect: {
        duration: 3000,
        animation: 'bronze_glow',
        sound: 'shodan_sound',
        color: '#cd7f32'
    },
    nidan_effect: {
        duration: 4000,
        animation: 'silver_sparkle',
        sound: 'nidan_sound',
        color: '#c0c0c0'
    },
    sandan_effect: {
        duration: 5000,
        animation: 'gold_explosion',
        sound: 'sandan_sound',
        color: '#ffd700'
    }
};
```

#### **実装内容**
1. **段位達成判定**
   - スコア更新時に段位変化をチェック
   - 段位昇格時の特別処理
   - 段位達成履歴の記録

2. **視覚効果**
   - 段位に応じた色の光効果
   - 画面全体のフラッシュ効果（0.5秒）
   - 段位名の大文字表示（3秒間）
   - パーティクルエフェクト

3. **サウンド効果**
   - 段位別の達成音（初段: 低音、二段: 中音、三段: 高音）
   - ボーナスポイント獲得音
   - 段位達成時の特別BGM（5秒間）

### 11.3 実績システム

#### **実績定義**
```javascript
const ACHIEVEMENTS = {
    FIRST_LINE: {
        id: 'first_line',
        name: '初回ライン消去',
        description: '初めてラインを消去しました',
        condition: (stats) => stats.totalLines >= 1,
        reward: { profileExp: 10, icon: '🎯' },
        category: 'basic'
    },
    DAILY_PLAYER: {
        id: 'daily_player',
        name: '連続プレイヤー',
        description: '7日連続でプレイしました',
        condition: (stats) => stats.consecutiveDays >= 7,
        reward: { profileExp: 50, icon: '🔥' },
        category: 'persistence'
    },
    SCORE_MILESTONE_1K: {
        id: 'score_1k',
        name: 'スコア1000点達成',
        description: 'スコア1000点を達成しました',
        condition: (stats) => stats.highestScore >= 1000,
        reward: { profileExp: 20, icon: '⭐' },
        category: 'score'
    },
    TETRIS_MASTER: {
        id: 'tetris_master',
        name: 'テトリスマスター',
        description: 'テトリス（4ライン消去）を10回達成',
        condition: (stats) => stats.totalTetris >= 10,
        reward: { profileExp: 100, icon: '🏆' },
        category: 'skill'
    },
    T_SPIN_EXPERT: {
        id: 'tspin_expert',
        name: 'T-Spinエキスパート',
        description: 'T-Spinを5回達成',
        condition: (stats) => stats.totalTSpin >= 5,
        reward: { profileExp: 80, icon: '🌀' },
        category: 'skill'
    },
    FEVER_LOVER: {
        id: 'fever_lover',
        name: 'フィーバー愛好者',
        description: 'フィーバーモードを50回発動',
        condition: (stats) => stats.totalFever >= 50,
        reward: { profileExp: 150, icon: '⚡' },
        category: 'fever'
    }
};
```

#### **実装内容**
1. **実績管理システム**
   - 実績の進捗追跡（localStorage使用）
   - 達成条件のリアルタイムチェック
   - プロフィール経験値の自動付与
   - 実績カテゴリ別の管理

2. **実績表示UI**
   - 実績一覧画面（カテゴリ別タブ）
   - 進捗バー表示（0-100%）
   - 達成済み/未達成の視覚的区別
   - 実績アイコンの表示

3. **実績通知**
   - 達成時のポップアップ表示（3秒間）
   - 実績獲得音（段階的な音階）
   - プロフィール経験値の視覚的表示
   - 実績履歴の記録

### 11.4 視覚的フィードバック強化

#### **ライン消去エフェクト設定**
```javascript
const LINE_CLEAR_EFFECTS = {
    SINGLE: {
        particles: 20,
        color: '#00ff88',
        duration: 1000,
        sound: 'single_clear',
        animation: 'sparkle'
    },
    DOUBLE: {
        particles: 40,
        color: '#ffd700',
        duration: 1500,
        sound: 'double_clear',
        animation: 'wave'
    },
    TRIPLE: {
        particles: 60,
        color: '#ff6b6b',
        duration: 2000,
        sound: 'triple_clear',
        animation: 'explosion'
    },
    TETRIS: {
        particles: 100,
        color: '#ff1493',
        duration: 3000,
        sound: 'tetris_clear',
        animation: 'fireworks'
    }
};
```

#### **ポイント獲得表示設定**
```javascript
const POINT_DISPLAY = {
    FONT_SIZE: '1.1em',
    ANIMATION_DURATION: 2000,
    FLOAT_DISTANCE: 50,
    COLORS: {
        normal: '#00ff88',
        bonus: '#ffd700',
        combo: '#ff6b6b',
        fever: '#ff1493'
    }
};
```

#### **実装内容**
1. **パーティクルシステム**
   - ライン消去時のキラキラ効果
   - ライン数に応じたパーティクル数（20-100個）
   - 色とアニメーションの変化
   - パーティクルの物理演算（重力、風）

2. **ポイント獲得アニメーション**
   - リアルタイムでのポイント表示
   - 獲得理由の表示（通常/ボーナス/コンボ/フィーバー）
   - フェードアウトアニメーション（2秒間）
   - 獲得ポイントの累積表示

3. **フィーバーモード進捗**
   - より詳細なゲージ表示（パーセンテージ表示）
   - 残りブロック数の数値表示
   - フィーバー突入予告表示（80%以上で点滅）
   - フィーバーゲージのグラデーション効果

### 11.5 デイリーチャレンジ

#### **チャレンジ定義**
```javascript
const DAILY_CHALLENGES = {
    LINE_CLEAR_10: {
        id: 'line_clear_10',
        name: 'ライン消去マスター',
        description: '10ライン消去する',
        target: 10,
        type: 'lines',
        reward: { profileExp: 30, streak: 1 },
        difficulty: 'easy'
    },
    FEVER_3: {
        id: 'fever_3',
        name: 'フィーバー愛好者',
        description: 'フィーバーモードを3回発動する',
        target: 3,
        type: 'fever',
        reward: { profileExp: 50, streak: 1 },
        difficulty: 'medium'
    },
    SCORE_5K: {
        id: 'score_5k',
        name: 'スコアハンター',
        description: '5000点を達成する',
        target: 5000,
        type: 'score',
        reward: { profileExp: 100, streak: 2 },
        difficulty: 'hard'
    },
    TETRIS_2: {
        id: 'tetris_2',
        name: 'テトリス達人',
        description: 'テトリス（4ライン消去）を2回達成する',
        target: 2,
        type: 'tetris',
        reward: { profileExp: 80, streak: 1 },
        difficulty: 'medium'
    },
    T_SPIN_1: {
        id: 'tspin_1',
        name: 'T-Spin挑戦者',
        description: 'T-Spinを1回達成する',
        target: 1,
        type: 'tspin',
        reward: { profileExp: 120, streak: 2 },
        difficulty: 'expert'
    }
};
```

#### **連続達成ボーナス**
```javascript
const STREAK_BONUS = {
    3: { profileExp: 50, title: '連続達成者', icon: '🔥' },
    7: { profileExp: 150, title: '週間チャンピオン', icon: '👑' },
    30: { profileExp: 500, title: '月間マスター', icon: '🏆' }
};
```

#### **実装内容**
1. **チャレンジ管理**
   - 日替わりチャレンジの生成（ランダム選択）
   - 進捗の追跡と更新（localStorage使用）
   - 達成判定とプロフィール経験値付与
   - チャレンジリセット（毎日0時）

2. **チャレンジUI**
   - チャレンジ一覧表示（難易度別色分け）
   - 進捗バーと残り時間表示
   - 達成済みチャレンジの表示（チェックマーク）
   - チャレンジ詳細画面

3. **連続達成システム**
   - 連続達成日数の記録
   - 連続達成ボーナスの計算
   - 特別な称号の付与
   - 連続達成の視覚的表示

### 11.6 カスタマイズ機能

#### **テトリミノスキン定義**
```javascript
const TETROMINO_SKINS = {
    default: {
        name: 'クラシック',
        unlockCondition: null,
        colors: {
            I: '#00f0f0', O: '#f0f000', T: '#a000f0',
            S: '#00f000', Z: '#f00000', J: '#0000f0', L: '#f0a000'
        },
        description: 'シンプルで見やすいクラシックデザイン'
    },
    neon: {
        name: 'ネオン',
        unlockCondition: { dan: 'godan' },
        colors: {
            I: '#00ffff', O: '#ffff00', T: '#ff00ff',
            S: '#00ff00', Z: '#ff0000', J: '#0000ff', L: '#ff8000'
        },
        glow: true,
        description: '光るネオンデザイン（五段以上で解放）'
    },
    crystal: {
        name: 'クリスタル',
        unlockCondition: { dan: 'rokudan' },
        colors: {
            I: '#e0f8ff', O: '#fff8e0', T: '#f8e0ff',
            S: '#e0ffe0', Z: '#ffe0e0', J: '#e0e0ff', L: '#fff0e0'
        },
        transparency: 0.8,
        description: '透明感のあるクリスタルデザイン（六段以上で解放）'
    },
    retro: {
        name: 'レトロ',
        unlockCondition: { achievement: 'tetris_master' },
        colors: {
            I: '#ff6b6b', O: '#4ecdc4', T: '#45b7d1',
            S: '#96ceb4', Z: '#feca57', J: '#ff9ff3', L: '#54a0ff'
        },
        pixelated: true,
        description: 'ピクセルアート風レトロデザイン（テトリスマスター実績で解放）'
    }
};
```

#### **フィールドテーマ定義**
```javascript
const FIELD_THEMES = {
    default: {
        name: 'ダーク',
        background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
        border: '#ffd700',
        grid: 'rgba(255, 255, 255, 0.1)',
        unlockCondition: null,
        description: 'シンプルなダークテーマ'
    },
    ocean: {
        name: 'オーシャン',
        background: 'linear-gradient(135deg, #1e3c72, #2a5298)',
        border: '#00ffff',
        grid: 'rgba(0, 255, 255, 0.2)',
        unlockCondition: { dan: 'yondan' },
        description: '海をイメージしたブルーテーマ（四段以上で解放）'
    },
    sunset: {
        name: 'サンセット',
        background: 'linear-gradient(135deg, #ff6b6b, #ffa500)',
        border: '#ffd700',
        grid: 'rgba(255, 215, 0, 0.2)',
        unlockCondition: { dan: 'rokudan' },
        description: '夕日をイメージしたオレンジテーマ（六段以上で解放）'
    },
    forest: {
        name: 'フォレスト',
        background: 'linear-gradient(135deg, #2d5016, #4a7c59)',
        border: '#90ee90',
        grid: 'rgba(144, 238, 144, 0.2)',
        unlockCondition: { achievement: 'daily_player' },
        description: '森をイメージしたグリーンテーマ（連続プレイヤー実績で解放）'
    }
};
```

#### **実装内容**
1. **スキン管理システム**
   - 段位に応じたスキン解放
   - スキンの選択と適用
   - プレビュー機能
   - スキン情報の表示

2. **テーマ管理システム**
   - 背景テーマの選択
   - カラーパレットの変更
   - エフェクト強度の調整
   - テーマ情報の表示

3. **カスタマイズUI**
   - 設定画面の作成（タブ形式）
   - スキンとテーマの選択画面
   - プレビュー表示（リアルタイム）
   - 解放条件の表示

### 11.7 サウンドシステム

#### **BGM定義**
```javascript
const BGM_TRACKS = {
    default: {
        name: 'メインテーマ',
        volume: 0.7,
        loop: true,
        description: '落ち着いたメインテーマ'
    },
    fever: {
        name: 'フィーバーモード',
        volume: 0.8,
        loop: true,
        description: 'アップテンポなフィーバーモードBGM'
    },
    dan_achievement: {
        name: '段位達成',
        volume: 0.9,
        loop: false,
        description: '段位達成時の特別BGM'
    },
    game_over: {
        name: 'ゲームオーバー',
        volume: 0.6,
        loop: false,
        description: 'ゲームオーバー時のBGM'
    }
};
```

#### **効果音定義**
```javascript
const SFX = {
    line_clear: {
        single: { volume: 0.8 },
        double: { volume: 0.8 },
        triple: { volume: 0.8 },
        tetris: { volume: 0.9 }
    },
    block_place: { volume: 0.6 },
    fever_start: { volume: 0.9 },
    dan_up: { volume: 0.9 },
    achievement: { volume: 0.8 },
    combo: { volume: 0.7 },
    button_click: { volume: 0.5 }
};
```

#### **実装内容**
1. **音声管理システム**
   - BGMと効果音の管理
   - 音量調整機能（マスター、BGM、効果音別）
   - 音声ファイルの読み込みとキャッシュ
   - 音声の再生制御

2. **段位別BGM**
   - 段位に応じたBGM変更
   - フィーバーモード時のBGM切り替え
   - フェードイン/アウト効果（2秒間）
   - 状況に応じたBGM選択

3. **サウンド設定UI**
   - 音量調整スライダー（0-100%）
   - BGM/効果音の個別設定
   - ミュート機能
   - 音声テスト機能

### 11.8 プロフィールシステム

#### **プロフィールレベルシステム**
```javascript
const PROFILE_LEVELS = {
    EXP_PER_LEVEL: 100,  // レベルアップに必要な経験値
    MAX_LEVEL: 100,      // 最大レベル
    EXP_MULTIPLIER: 1.1  // レベルごとの経験値倍率
};

const PROFILE_REWARDS = {
    10: { title: '初心者', icon: '🌱' },
    25: { title: '中級者', icon: '🌿' },
    50: { title: '上級者', icon: '🌳' },
    75: { title: 'マスター', icon: '🏆' },
    100: { title: '伝説', icon: '👑' }
};
```

#### **実装内容**
1. **プロフィール管理**
   - プロフィール経験値の蓄積
   - レベルアップ判定と処理
   - プロフィール情報の保存

2. **プロフィール画面**
   - レベルと経験値の表示
   - 獲得した称号の表示
   - 統計情報の表示
   - カスタマイズ設定

3. **経験値獲得**
   - 実績達成時の経験値付与
   - デイリーチャレンジ達成時の経験値付与
   - 連続達成ボーナスの経験値付与

### 11.9 実装優先度とスケジュール

#### **Phase 1（即座に実装可能）**
1. **コンボシステム強化** - 既存機能の拡張（1-2日）
2. **段位達成ボーナス** - 調整済みボーナスシステム（1日）

#### **Phase 2（短期実装）**
3. **実績システム** - 小さな目標達成の記録（3-5日）
4. **視覚的フィードバック強化** - 既存UIの改善（2-3日）

#### **Phase 3（中期実装）**
5. **デイリーチャレンジ** - 日替わり目標システム（5-7日）
6. **カスタマイズ機能** - スキンとテーマ（7-10日）

#### **Phase 4（長期実装）**
7. **サウンドシステム** - BGMと効果音（10-14日）
8. **リプレイ機能** - プレイ記録と分析（14-21日）

各機能は独立して実装可能であり、優先度に応じて段階的に追加していくことができます。

### 11.10 レベルシステム詳細仕様

#### **時間ベースレベルアップシステム**
```javascript
const LEVEL_SYSTEM = {
    LEVEL_UP_INTERVAL: 30000,  // 30秒（ミリ秒）
    MAX_LEVEL: 30,             // 最大レベル
    
    // レベル別自然落下速度（秒/行）- より激しい上昇
    FALL_SPEEDS: {
        1: 1.0,   2: 0.9,   3: 0.8,   4: 0.7,   5: 0.6,
        6: 0.55,  7: 0.5,   8: 0.45,  9: 0.4,   10: 0.4,
        11: 0.38, 12: 0.36, 13: 0.34, 14: 0.32, 15: 0.3,
        16: 0.28, 17: 0.26, 18: 0.25, 19: 0.24, 20: 0.25,
        21: 0.24, 22: 0.23, 23: 0.22, 24: 0.21, 25: 0.22,
        26: 0.21, 27: 0.205, 28: 0.2, 29: 0.2, 30: 0.2
    },
    
    // レベル別スコア倍率
    SCORE_MULTIPLIERS: {
        1: 1.0,   2: 1.05,  3: 1.1,   4: 1.15,  5: 1.2,
        6: 1.25,  7: 1.3,   8: 1.35,  9: 1.4,   10: 1.5,
        11: 1.6,  12: 1.7,  13: 1.8,  14: 1.9,  15: 2.0,
        16: 2.1,  17: 2.2,  18: 2.3,  19: 2.4,  20: 2.5,
        21: 2.6,  22: 2.7,  23: 2.8,  24: 2.9,  25: 3.0,
        26: 3.1,  27: 3.2,  28: 3.3,  29: 3.4,  30: 3.5
    }
};
```

#### **実装内容**
1. **時間管理システム**
   - ゲーム開始からの経過時間を追跡
   - 30秒ごとのレベルアップ判定
   - レベルアップ時の視覚・音響効果

2. **落下速度管理**
   - レベルに応じた落下速度の動的変更
   - スムーズな速度変化（アニメーション）
   - フィーバーモード中の速度調整

3. **スコア倍率適用**
   - リアルタイムでのスコア倍率計算
   - レベルアップ時の倍率変更通知
   - フィーバーモードとの組み合わせ計算

### 11.11 ブロック交換累積コストシステム

#### **累積コスト定義**
```javascript
const EXCHANGE_COST_SYSTEM = {
    BASE_COST: 30,           // 基本コスト
    COST_INCREMENTS: [15, 20, 25, 30],  // 累積増加量
    MAX_COST: 120,           // 最大コスト
    RESET_TRIGGER: 'block_placed'  // リセット条件
};

const EXCHANGE_COSTS = {
    1: 30,   // 1回目
    2: 45,   // 2回目（+15）
    3: 65,   // 3回目（+20）
    4: 90,   // 4回目（+25）
    5: 120   // 5回目以降（+30ずつ）
};
```

#### **実装内容**
1. **コスト管理システム**
   - 連続交換回数の追跡
   - 累積コストの計算
   - コストリセット条件の判定

2. **UI表示システム**
   - 現在の交換コストの表示
   - 累積コストの視覚的警告
   - コストリセットの通知

3. **戦略的制限**
   - 連続使用の制限
   - コスト効率の最適化
   - リスク管理の必要性