# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

**ClaudeTetris** - **PCユーザー専用**の革新的なポイントシステムとフィーバーモードを持つWebベースのテトリスゲーム。全画面プレイに最適化され、縦横レイアウト切り替え機能を搭載。モダンブラウザ向けにHTML5、CSS3、JavaScript（ES6+）で構築。

## ターゲット層

- **プライマリターゲット**: PCユーザー（デスクトップ・ノートPC）
- **推奨環境**: 1200px以上の画面サイズ、全画面ブラウザ
- **操作方法**: キーボード操作専用
- **プレイスタイル**: 長時間の集中プレイ、高スコア追求

## 現在の実装状況（実装完了度: 約85%）

### ✅ 実装済み機能
**コア機能は完全に動作し、PC全画面プレイに最適化された状態**

#### 基本ゲーム機能
- **基本ゲームシステム**: テトリス標準機能（10x20グリッド、7種テトリミノ、ライン消去）
- **ポイント&エクスチェンジシステム**: ポイント獲得・消費、NEXTブロック交換、累積コスト
- **フィーバーモードシステム**: 20ブロック設置で発動、30秒間の4倍スコア・無料交換
- **時間ベースレベルシステム**: 30秒ごと自動レベルアップ、速度・倍率調整
- **段位システム**: 14段階（無段〜永世名人）、リアルタイム表示、昇格ボーナス
- **テクニカル要素**: T-Spin検出、コンボシステム、Back-to-Back、パーフェクトクリア
- **ホールド機能**: 標準テトリスのホールド（Cキー）

#### PC最適化機能
- **全画面レイアウト**: 1200px以上の大画面に最適化（ゲームフィールド320x640px）
- **縦横切り替え機能**: リアルタイムレイアウト変更（横: 3エリア構成、縦: 縦積み構成）
- **縦方向圧縮**: 画面領域を効率的に活用する最適化
- **高解像度対応**: 大きなフォント・適切な間隔・視認性向上

#### UI・UX機能
- **UI・UXシステム**: PC向け3エリア構成、視覚エフェクト、操作説明
- **データ管理**: スコア記録・ランキング（トップ10）、統計情報
- **実績システム**: 15種類の実績、カテゴリ別分類、進捗表示

#### パフォーマンス最適化
- **フィーバーモード最適化**: GPU加速、パーティクル数削減（20→8個）、軽量アニメーション

### ❌ 未実装機能
**将来の拡張機能（コアゲームプレイには影響しない）**

#### 高優先度（短期実装予定）
- **サウンドシステム**: BGM・効果音・ボリューム調整
- **キーボードカスタマイズ**: キーバインド変更機能
- **ゲーム設定**: 落下速度調整、視覚効果オン/オフ

#### 中優先度（中期実装予定）
- **デイリーチャレンジシステム**: 日替わり目標・特別報酬
- **視覚カスタマイズ**: テーマ・カラーパレット変更
- **統計分析強化**: 詳細プレイ分析・グラフ表示

#### 低優先度（長期実装予定）
- **リプレイ機能**: プレイ記録・再生・分析
- **プロフィールシステム**: 経験値・称号・アバター
- **アクセシビリティ機能**: 色覚サポート・音声ガイド

## プロジェクトアーキテクチャ

### コアゲームメカニクス
- **ポイントシステム**: テトリミノ設置10P、ソフトドロップ0.5P/行、ハードドロップ1P/行
- **ブロック交換**: 累積コスト（30P→45P→65P→90P→120P）、設置でリセット
- **フィーバーモード**: 20ブロック設置で発動、30秒間4倍スコア・無料交換
- **ホールドシステム**: 標準テトリスのホールド機能（Cキー）

### ゲーム構造
- **ゲームフィールド**: 10x20グリッド
- **テトリミノタイプ**: 標準7種類（I, O, T, S, Z, J, L）
- **UIレイアウト**: レスポンシブ2モード
  - **横向きレイアウト**: 3エリア構成（左: HOLD・レベル・フィーバー | 中央: ゲームフィールド | 右: スコア・NEXT・統計）
  - **縦向きレイアウト**: 縦積み構成（中央: ゲームフィールド | 下部: 情報パネル3列グリッド）

### 操作方法
- **矢印キー**: 移動（左/右/ソフトドロップ）と回転（上）
- **スペース**: ハードドロップ
- **C**: ホールド機能
- **E**: NEXTブロック交換（独自機能）
- **⟲ボタン**: 縦横レイアウト切り替え（画面右上）

## 開発コマンド

```bash
# 開発サーバー起動
python -m http.server 8000
# または
npx serve .

# テスト: ブラウザでの手動テスト（Chrome, Firefox, Safari, Edge）
```

## 現在のファイル構造

```
tetris/
├── index.html              # メインゲームページ（実装済み）
├── style.css               # ゲームスタイリング（実装済み）
├── script.js               # メインゲームロジック（実装済み）
├── js/
│   ├── tetrominos.js       # テトリミノ定義（実装済み）
│   ├── gameField.js        # ゲームフィールド管理（実装済み）
│   ├── pointSystem.js      # ポイント&スコアシステム（実装済み）
│   ├── feverMode.js        # フィーバーモード（実装済み）
│   ├── scoreManager.js     # スコア&段位管理（実装済み）
│   ├── achievementSystem.js # 実績システム（実装済み）
│   └── ui.js               # UI管理（実装済み）
├── CLAUDE.md               # 開発仕様書
└── readme.txt              # プロジェクト概要
```

## 実装済みシステム詳細

### ポイント&エクスチェンジシステム
- **ポイント獲得**: ブロック設置10P、ドロップボーナス
- **交換コスト**: 30P→45P→65P→90P→120P（累積、設置でリセット）
- **フィーバー中**: 無料無制限交換

### フィーバーモードシステム
- **発動条件**: 20ブロック設置
- **効果**: 30秒間、4倍スコア、無料交換
- **視覚効果**: パーティクル、背景変更、アニメーション

### レベル&段位システム
- **レベル**: 30秒ごと自動アップ（最大30）、速度・倍率調整
- **段位**: 14段階、スコアベース、昇格ボーナス・エフェクト

### テクニカル要素
- **T-Spin**: 検出・ボーナススコア
- **コンボ**: 連続ライン消去でボーナス
- **Back-to-Back**: テトリス・T-Spin連続で1.5倍
- **パーフェクトクリア**: 全消し25,000点ボーナス

### 実績システム
- **15種類の実績**: 基本・スコア・テクニカル・特殊・チャレンジ
- **進捗管理**: カテゴリ別表示、解除通知
- **ポイント報酬**: 実績達成でボーナスポイント

## スコア計算システム
- **基本**: 1ライン100点、2ライン300点、3ライン500点、4ライン800点
- **レベル倍率**: 1.0〜3.5倍（レベル30で最大）
- **フィーバー倍率**: 4倍（フィーバーモード中）
- **テクニカルボーナス**: T-Spin、Back-to-Back、コンボ

## 実装注意事項

### 技術要件
- **60fps保証**: 滑らかなアニメーションとレスポンス（GPU加速活用）
- **モジュール設計**: クラスベース、機能別分離
- **データ永続化**: localStorage使用
- **PC最適化**: 1200px以上の大画面専用設計

### パフォーマンス要件
- **フィーバーモード最適化**: will-change、translate3d()によるGPU加速
- **軽量アニメーション**: パーティクル数削減、アニメーション頻度調整
- **メモリ管理**: 適切なクリーンアップ処理

### コード品質
- **命名規則**: 明確で一貫した命名
- **コメント**: 必要最小限、意図を説明
- **拡張性**: 新機能追加に対応可能な構造

### デザイン要件
- **カラーパレット**: 深いグレー（#1a1a1a, #2d2d2d）、ネオン（#00ff88）、金色（#ffd700）
- **タイポグラフィ**: 'Segoe UI', 'Consolas'（数値）
- **視覚エフェクト**: グラデーション、シャドウ、グロー効果
- **アニメーション**: CSS transforms、cubic-bezier、GPU加速

## 実装完了機能の詳細

### 最新追加機能（2024年実装）
1. **PC全画面最適化**: 1200px以上専用レイアウト、縦方向圧縮
2. **縦横切り替え機能**: リアルタイムレイアウト変更システム
3. **フィーバーパフォーマンス最適化**: GPU加速、軽量化

### レスポンシブ対応完了
- **モバイル対応無効化**: PC専用に特化
- **縦向きレイアウト**: 3列グリッド情報パネル
- **横向きレイアウト**: 標準3エリア構成

## 開発フェーズ計画

### Phase 1（短期実装：1-2週間）
1. **サウンドシステム**: BGM・効果音・音量調整
2. **キーボードカスタマイズ**: キーバインド設定画面
3. **ゲーム設定画面**: 各種オプション設定

### Phase 2（中期実装：1-2ヶ月）
4. **デイリーチャレンジ**: 日替わり目標システム
5. **視覚カスタマイズ**: テーマ・カラー変更機能
6. **統計分析強化**: 詳細データ・グラフ表示

### Phase 3（長期実装：3-6ヶ月）
7. **リプレイ機能**: プレイ記録・再生システム
8. **プロフィールシステム**: 経験値・称号・実績拡張

---

## 重要仕様

### 段位システム詳細
```
無段: 0点〜 | 初段: 200点〜 | 二段: 800点〜 | 三段: 2,000点〜
四段: 4,000点〜 | 五段: 8,000点〜 | 六段: 15,000点〜 | 七段: 25,000点〜
八段: 40,000点〜 | 九段: 60,000点〜 | 十段: 90,000点〜
名人: 130,000点〜 | 竜王: 200,000点〜 | 永世名人: 300,000点〜
```

### フィーバーモード設定
```javascript
const FEVER_CONFIG = {
    BLOCKS_NEEDED: 20,        // 発動に必要なブロック数
    DURATION: 30000,          // 持続時間（30秒）
    SCORE_MULTIPLIER: 4       // スコア倍率
};
```

### 交換コストシステム
```javascript
const EXCHANGE_COSTS = [30, 45, 65, 90, 120]; // 累積コスト
```

このプロジェクトは現在完全にプレイ可能な状態であり、コア機能は全て実装済みです。

## PC専用最適化の詳細

### 実装済み最適化機能
1. **モバイル対応の無効化**: @media (max-width: 0px)によりモバイル用CSSを無効化
2. **大画面レイアウト**: 1200px以上で最適化されたレイアウト
3. **縦方向圧縮**: 画面領域の効率的活用
4. **高解像度対応**: 大きなフォント・適切な間隔

### 縦横切り替えシステム
- **OrientationToggleクラス**: 動的レイアウト変更
- **切り替えボタン**: 右上固定位置、ホバーアニメーション
- **2つのレイアウトモード**: 横向き（3エリア）・縦向き（縦積み）

### フィーバーモード最適化詳細
- **パーティクル削減**: 20個 → 8個
- **GPU加速**: will-change、translate3d()活用
- **アニメーション軽量化**: 頻度・強度調整
- **遅延ロード**: 200ms遅延でパーティクル生成