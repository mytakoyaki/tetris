# 🎮 ClaudeTetris 技術仕様書

## 📋 プロジェクト概要

**ClaudeTetris** - PCユーザー専用の革新的なポイントシステムとフィーバーモードを持つWebベースのテトリスゲーム。全画面プレイに最適化され、縦横レイアウト切り替え機能を搭載。モダンブラウザ向けにHTML5、CSS3、JavaScript（ES6+）で構築。

**実装完了度: 約85%**

## 🎯 ターゲット仕様

### 対象環境
- **プライマリターゲット**: PCユーザー（デスクトップ・ノートPC）
- **推奨環境**: 1200px以上の画面サイズ、全画面ブラウザ
- **操作方法**: キーボード操作専用
- **プレイスタイル**: 長時間の集中プレイ、高スコア追求

### 対応ブラウザ
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

## 🏗️ システムアーキテクチャ

### ファイル構造
```
tetris/
├── index.html              # メインゲームページ
├── style.css               # ゲームスタイリング
├── script.js               # メインゲームロジック
├── js/
│   ├── tetrominos.js       # テトリミノ定義
│   ├── gameField.js        # ゲームフィールド管理
│   ├── pointSystem.js      # ポイント&スコアシステム
│   ├── feverMode.js        # フィーバーモード
│   ├── scoreManager.js     # スコア&段位管理
│   ├── achievementSystem.js # 実績システム
│   └── ui.js               # UI管理
├── CLAUDE.md               # 開発仕様書
└── readme.txt              # プロジェクト概要
```

### モジュール設計
- **クラスベース設計**: 各機能を独立したクラスとして実装
- **機能別分離**: 責任の明確な分離による保守性向上
- **コールバックシステム**: モジュール間の疎結合通信

## 🎮 コアゲームシステム

### ゲームフィールド仕様
- **グリッドサイズ**: 10×20
- **テトリミノタイプ**: 標準7種類（I, O, T, S, Z, J, L）
- **落下速度**: レベルに応じて段階的に加速
- **ウォールキック**: 回転時の壁際対応

### ポイント&エクスチェンジシステム
#### ポイント獲得
- **ブロック設置**: 10ポイント
- **ソフトドロップ**: 0.5ポイント/行
- **ハードドロップ**: 1ポイント/行
- **実績達成**: 実績に応じて5～200ポイント

#### 有料機能
- **ホールド**: 15ポイント（2スロット利用可能）
- **交換**: 累積コスト制（45P → 65P → 90P → 120P → 160P）
- **ライン削除**: 200ポイント（最下段のラインを削除）

#### 交換システム
- **累積コスト制**: 45P → 65P → 90P → 120P → 160P
- **ブロック設置でリセット**: 新しいテトリミノ設置時にコストがリセット
- **フィーバー中は無料**: フィーバーモード中は無制限に無料交換可能

### フィーバーモードシステム
- **発動条件**: 20ブロック設置（自動発動）
- **持続時間**: 30秒間
- **効果**:
  - スコア4倍
  - 無制限無料交換
  - 専用視覚エフェクト

### レベル&時間システム
- **自動レベルアップ**: 30秒ごと（最大レベル30）
- **落下速度**: レベルに応じて段階的に加速
- **スコア倍率**: レベル上昇と共に増加（最大2.0倍）

## 🏆 スコア&段位システム

### スコア計算システム
#### 基本スコア
| ライン数 | 基本スコア | 説明 |
|----------|------------|------|
| 1ライン | 100点 | シングル |
| 2ライン | 400点 | ダブル |
| 3ライン | 1000点 | トリプル |
| 4ライン | 2000点 | テトリス |

#### ボーナス計算
- **レベル倍率**: 1.0～2.0倍（レベル1～30）
- **フィーバー倍率**: 4倍
- **T-Spinボーナス**: 
  - T-Spin Single: 2000点
  - T-Spin Double: 5000点
  - T-Spin Triple: 10000点
- **Back-to-Backボーナス**: 2.0倍（テトリス・T-Spin連続時）
- **コンボボーナス**: 連続ライン消去で最大2.0倍まで加算
- **パーフェクトクリアボーナス**: 30000点

### 段位システム
```
無段(0点) → 初段(200点) → 二段(800点) → 三段(2,000点)
→ 四段(4,000点) → 五段(8,000点) → 六段(15,000点) → 七段(25,000点)
→ 八段(40,000点) → 九段(60,000点) → 十段(90,000点)
→ 名人(130,000点) → 竜王(200,000点) → 永世名人(300,000点)
```

## 🎯 実績システム

### 実績カテゴリ
- **基本**: 基本的なゲームプレイ実績
- **スコア**: スコア関連の実績
- **技術**: テクニカル要素の実績
- **チャレンジ**: 特定条件でのプレイ実績
- **特殊/やりこみ**: 長期プレイ向け実績

### 実績機能
- **15種類の実績**: 多様な達成目標・称号
- **進捗管理**: カテゴリ別表示、解除通知
- **ポイント報酬**: 実績達成でボーナスポイント

## 🎨 UI/UXシステム

### レイアウト仕様
#### 横向きレイアウト（デフォルト・3エリア構成）
```
┌─────────┬─────────────────┬─────────┐
│ HOLD 1  │                 │ SCORE   │
│ HOLD 2  │   ゲームフィールド    │ POINTS  │
│ LEVEL   │     (10×20)     │ NEXT    │
│ FEVER   │                 │ 統計情報 │
│ 段位表示 │                 │         │
└─────────┴─────────────────┴─────────┘
```

#### 縦向きレイアウト（縦積み構成）
```
┌─────────────────────────┐
│      ゲームフィールド        │
│        (10×20)           │
├─────────────────────────┤
│HOLD1│HOLD2│LEVEL│FEVER │
├─────┼─────┼─────┼──────┤
│SCORE│POINTS│NEXT│段位表示│
└─────┴─────┴─────┴──────┘
```

### デザイン仕様
#### カラーパレット
- **背景色**: 深いグレー（#1a1a1a, #2d2d2d）
- **アクセント色**: ネオン（#00ff88）
- **強調色**: 金色（#ffd700）
- **テキスト色**: 白色（#ffffff）

#### タイポグラフィ
- **基本フォント**: 'Segoe UI'
- **数値フォント**: 'Consolas'
- **フォントサイズ**: 画面サイズに応じて動的調整

#### 視覚エフェクト
- **グラデーション**: 背景・ボタン・パネル
- **シャドウ**: 深度表現
- **グロー効果**: アクセント要素
- **アニメーション**: CSS transforms、cubic-bezier

## ⌨️ 操作システム

### 基本操作
| キー | 動作 | 詳細 |
|------|------|------|
| `←` `→` | 左右移動 | テトリミノを左右に移動 |
| `↑` | 回転 | テトリミノを時計回りに回転（ウォールキック対応） |
| `↓` | ソフトドロップ | 加速落下（0.5P/行のボーナス付き） |
| `スペース` | ハードドロップ | 即座に底まで落下（1P/行のボーナス付き） |
| `C` | ホールド1 | テトリミノを1番目のホールドスロットに保留（15P） |
| `V` | ホールド2 | テトリミノを2番目のホールドスロットに保留（15P） |
| `E` | 交換 | NEXTテトリミノを変更（累積コスト制） |
| `L` | ライン削除 | 最下段のラインを削除（200P） |

### UI操作
| 操作 | 動作 |
|------|------|
| `⟲` ボタン（右上） | 縦横レイアウト切り替え |
| 各種ボタン | 実績・ランキング・設定画面アクセス |

## 🔧 テクニカル要素

### T-Spinシステム
- **T-Spin Single**: 2000点ボーナス
- **T-Spin Double**: 5000点ボーナス
- **T-Spin Triple**: 10000点ボーナス
- **検出アルゴリズム**: 回転後の位置判定

### コンボシステム
- **連続ライン消去**: コンボカウント増加
- **コンボボーナス**: 最大2.0倍まで加算
- **コンボブレイク**: ライン消去失敗でリセット

### Back-to-Backシステム
- **発動条件**: テトリス・T-Spin連続
- **ボーナス倍率**: 2.0倍
- **リセット条件**: 通常ライン消去

### パーフェクトクリア
- **条件**: フィールド内の全ブロック消去
- **ボーナス**: 30000点

## 💾 データ管理

### ローカルストレージ
- **スコア記録**: トップ10スコア保存
- **統計情報**: 総プレイ時間、総ライン数等
- **実績データ**: 実績達成状況・進捗
- **設定情報**: ユーザー設定

### データ構造
```javascript
// スコアデータ
{
  score: number,
  level: number,
  totalLines: number,
  tetrisCount: number,
  tspinCount: number,
  totalBlocksPlaced: number,
  playTime: number,
  timestamp: number
}

// 実績データ
{
  id: string,
  name: string,
  description: string,
  category: string,
  points: number,
  unlocked: boolean,
  progress: number,
  maxProgress: number
}
```

## ⚡ パフォーマンス仕様

### フレームレート
- **目標**: 60fps保証
- **GPU加速**: CSS transforms、will-change活用
- **アニメーション最適化**: requestAnimationFrame使用

### メモリ管理
- **適切なクリーンアップ**: イベントリスナー・タイマー管理
- **オブジェクトプール**: パーティクル・アニメーション要素
- **ガベージコレクション**: 不要オブジェクトの早期解放

### フィーバーモード最適化
- **パーティクル数削減**: 20個 → 8個
- **軽量アニメーション**: アニメーション頻度調整
- **GPU加速**: translate3d()、will-change活用

## 🔒 セキュリティ仕様

### データ保護
- **ローカルストレージ**: ブラウザ内のみ保存
- **外部通信**: なし（完全オフライン動作）
- **プライバシー**: 個人情報収集なし

### 入力検証
- **キー入力**: 適切なキーコード検証
- **データ検証**: ローカルストレージデータの整合性チェック

## 📱 レスポンシブ対応

### PC最適化
- **最小画面サイズ**: 1200px以上
- **全画面プレイ**: ブラウザ全画面での最適化
- **縦横切り替え**: リアルタイムレイアウト変更

### モバイル対応
- **無効化**: PC専用設計のためモバイル対応なし
- **理由**: キーボード操作・大画面表示に特化

## 🚀 開発環境

### 開発サーバー
```bash
# 開発サーバー起動
python -m http.server 8000
# または
npx serve .

# テスト: ブラウザでの手動テスト（Chrome, Firefox, Safari, Edge）
```

### ブラウザテスト
- **Chrome**: 最新版
- **Firefox**: 最新版
- **Safari**: 最新版
- **Edge**: 最新版

## 📊 実装完了機能一覧

### ✅ 実装済み機能
1. **基本ゲームシステム**: テトリス標準機能
2. **ポイント&エクスチェンジシステム**: ポイント獲得・消費・交換
3. **フィーバーモードシステム**: 20ブロック設置で発動
4. **時間ベースレベルシステム**: 30秒ごと自動レベルアップ
5. **段位システム**: 14段階、リアルタイム表示
6. **テクニカル要素**: T-Spin、コンボ、Back-to-Back、パーフェクトクリア
7. **ホールド機能**: 標準テトリスのホールド
8. **全画面レイアウト**: 1200px以上の大画面最適化
9. **縦横切り替え機能**: リアルタイムレイアウト変更
10. **UI・UXシステム**: PC向け3エリア構成
11. **データ管理**: スコア記録・ランキング・統計情報
12. **実績システム**: 15種類の実績、カテゴリ別分類
13. **パフォーマンス最適化**: 60fps保証、GPU加速

### ❌ 未実装機能
1. **サウンドシステム**: BGM・効果音・音量調整
2. **キーボードカスタマイズ**: キーバインド変更機能
3. **ゲーム設定**: 落下速度調整、視覚効果オン/オフ
4. **デイリーチャレンジシステム**: 日替わり目標・特別報酬
5. **視覚カスタマイズ**: テーマ・カラーパレット変更
6. **統計分析強化**: 詳細プレイ分析・グラフ表示
7. **リプレイ機能**: プレイ記録・再生・分析
8. **プロフィールシステム**: 経験値・称号・アバター
9. **アクセシビリティ機能**: 色覚サポート・音声ガイド

## 🔮 将来拡張予定

### Phase 1（短期実装：1-2週間）
- サウンドシステム
- キーボードカスタマイズ
- ゲーム設定画面

### Phase 2（中期実装：1-2ヶ月）
- デイリーチャレンジ
- 視覚カスタマイズ
- 統計分析強化

### Phase 3（長期実装：3-6ヶ月）
- リプレイ機能
- プロフィールシステム

---

**最終更新**: 2024年12月
**バージョン**: 1.0.0
**実装完了度**: 85% 